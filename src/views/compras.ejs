<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>compras</title>
    <link rel="stylesheet" href="/css/estilo.css">
</head>

<body class="light-theme">
    <h1>CAFETERIA DO DEDE</h1>
    <p>Seja bem-vindo(a), <%= nome %>!</p>

    <nav class="navbar">
        <!-- Botão Hambúrguer -->
        <button class="hamburger" onclick="toggleMenu()">&#9776;</button>

        <!-- Links da Navbar -->
        <div class="navbar-links">
            <button class="logout"><a href="/logout">Sair</a></button>
            <button id="theme-toggle">Dark Mode</button>
            <button><a href="/main2">Produtos</a></button>
            <button><a href="/compras/listar">Minhas Compras</a></button>
            <!-- Imagem do logo -->
            <img class="logo-imagem" src="/uploads/cafelogo.jpg" alt="logo de café">
        </div>
    </nav>


    <table class="table container">
        <caption>COMPRAS:</caption>

        <tr>
            <th>nome do produto</th>
            <th>imagem</th>
            <th>quantidade</th>
            <th>Valor total</th>
            <th>estado do pedido</th>
            <th>ação</th>
        </tr>
        <% lista_de_compras.forEach(item=> { %>
            <tr>
                <td>
                    <%= item.nome %>
                </td>
                <!-- imagem -->
                <td>
                    <% if (item.imagem) { %>
                        <img src="/uploads/<%= item.imagem %>" class="produto-imagem" alt="produto">
                        <% } else { %>
                            <span>Sem imagem</span>
                            <% } %>
                </td>

                <td>
                    <%= item.quantidade %>
                </td>
                <td>
                    <%= item.valor_total %>
                </td>
                <td class="estado_da_compra">
                    <%= item.estado %>
                </td>
                <td>
                    <% if (item.estado !== "confirmado") { %>
                        <button
                            onclick="confirmAction('/compra/confirmar/<%= item.id_vendas %>', 'confirmar')">confirmar</button>
                        <button
                            onclick="confirmAction('/compra/editar/<%= item.id_vendas %>', 'editar')">editar</button>
                        <button
                            onclick="confirmAction('/compra/deletar/<%= item.id_vendas %>', 'excluir')">excluir</button>
                            <% } else { %>
                                <button onclick="viewAction('/compra/ver/<%= item.id_vendas %>')">ver</button>
                            <% } %>

                </td>
            </tr>
            <% }) %>
    </table>

    <script>
        function confirmAction(url, action) {
            let message = '';
            if (action === 'excluir') {
                message = 'Você tem certeza que deseja excluir?';
            } else if (action === 'confirmar') {
                message = 'Você tem certeza que deseja confirmar?';
            } else {
                window.location.href = url;
                return;
            }

            if (confirm(message)) {
                window.location.href = url;
            }
        }
    </script>

</body>
<script src="/script/script.js"></script>

</html>